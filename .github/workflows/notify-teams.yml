name: Notify
on:
  push:
    branches:
      - feat/AB#12345-trigger-workflow

jobs:
  first-job:
    runs-on: ubuntu-latest
    steps:
      - name: Print the hello message
        run: |
          echo "Hello World!"
          exit 1

      - name: print 2
        run: echo "hello again"

  notify:
    runs-on: ubuntu-latest
    needs: first-job
    if: always()
    steps:
      - name: Set URL Variable
        id: set_url
        run: echo "::set-output name=url::${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

      - name: Send teams notification on failure
        if: ${{ needs.first-job.result == 'failure' }}
        uses: simbo/msteams-message-card-action@latest
        with:
          webhook: ${{ secrets.MSTEAMS_WEBHOOK }}
          title: Insights copilot DEV Pipeline has failed.
          message: >
            <p>Dev deployment has <strong> <span style="color: #C41E3A;">failed.</span></strong>
            <br>Please find the issue details here and proceed to create a Hotfix branch</p>
          buttons: |
            Failure logs ${{ steps.set_url.outputs.url }}

      - name: Send teams notification on success
        if: ${{ needs.first-job.result == 'success' }}
        uses: simbo/msteams-message-card-action@latest
        with:
          webhook: ${{ secrets.MSTEAMS_WEBHOOK }}
          title: Insights copilot DEV Pipeline has successfully completed
          message: >
            <p>Dev deployment <strong> <span style="color: #008000;">successfully completed.</span></strong>
            <br>Check the application below and provide your approval for QA deployment</p>
          buttons: |
            Approve ${{ steps.set_url.outputs.url }}
            View application at DEV https://brave-plant-0672fef10.3.azurestaticapps.net/
          
